@page "/default"

@inject ISnackbar Snackbar

    <div class="calc-body">
        <div class="result-display">
        <h1 id="result-display">@(_resultDisplay != "" ? Convert.ToDouble(_resultDisplay).ToString("#,##0") : "0")</h1>
        </div>
        <div class="calc-display">
        <h3 id="calc-display">@_calcDisplay</h3>
        </div>
        <div class="btn-wrap">
            <button onclick="@allClear" class="btn btn-orange">AC</button>
            <button onclick="@del" class="btn btn-orange">C</button>
            <button onclick="@(() => handleOperation("."))" class="btn">.</button>
            <button onclick="@(() => handleOperation("÷"))" class="btn btn-orange">&#247</button>
            <button onclick="@(() => handleOperation("7"))" class="btn">7</button>
            <button onclick="@(() => handleOperation("8"))" class="btn">8</button>
            <button onclick="@(() => handleOperation("9"))" class="btn">9</button>
            <button onclick="@(() => handleOperation("X"))" class="btn btn-orange">X</button>
            <button onclick="@(() => handleOperation("4"))" class="btn">4</button>
            <button onclick="@(() => handleOperation("5"))" class="btn">5</button>
            <button onclick="@(() => handleOperation("6"))" class="btn">6</button>
            <button onclick="@(() => handleOperation("-"))" class="btn btn-orange">-</button>
            <button onclick="@(() => handleOperation("1"))" class="btn">1</button>
            <button onclick="@(() => handleOperation("2"))" class="btn">2</button>
            <button onclick="@(() => handleOperation("3"))" class="btn">3</button>
            <button onclick="@(() => handleOperation("+"))" class="btn btn-orange">+</button>
            <button onclick="@(() => handleOperation("0"))" class="btn-0">0</button>
            <button onclick="@(() => handleOperation("="))" class="btn btn-lg">=</button>
        </div>
    </div>

@code {
    string _calcDisplay = "";
    string _resultDisplay = "";

    public static double Evaluate(string expression)
    {
        System.Data.DataTable table = new System.Data.DataTable();
        table.Columns.Add("expression", string.Empty.GetType(), expression);
        System.Data.DataRow row = table.NewRow();
        table.Rows.Add(row);
        return double.Parse((string)row["expression"]);
    }

    void handleOperation(string e)
    {
        if (e == "=")
        {
            //_calcDisplay = _resultDisplay;
            _resultDisplay = _calcDisplay != "" ? Evaluate(_calcDisplay).ToString() : "";
        }
        else {
            var display = _calcDisplay + e;
            _calcDisplay = display;
            try
            {
                var fixedOperation = display.Replace("X", "*");
                fixedOperation = fixedOperation.Replace("÷", "/");
                fixedOperation = fixedOperation.Replace(".", ".");

                //_resultDisplay = Evaluate(fixedOperation).ToString();
                _calcDisplay = fixedOperation;
            }
            catch (Exception err)
            {
                Snackbar.Add(err.Message, Severity.Error);
            }
        }
    }


    private void allClear() {
        _calcDisplay = "";
        _resultDisplay = "";
    }

    private void del()
    {
        var display = _calcDisplay != "" ? _calcDisplay.Remove(_calcDisplay.Length - 1, 1) : "";

        _calcDisplay = display;
        //_resultDisplay = "";
    }

}
